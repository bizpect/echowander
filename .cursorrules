이 프로젝트는 Echowander Flutter 모바일 앱이다.
(Flutter + Supabase 기반, 글로벌 익명 메시지 앱)

==================================================
[공통 규칙]
==================================================
- 기존 아키텍처(feature-first clean architecture)를 반드시 유지한다.
- 요청 없이 대규모 리팩터링, 재작성, 구조 변경 금지.
- 변경은 항상 최소 단위(diff 최소화)로 수행한다.
- 새로운 코드 작성 전 반드시 기존 코드 재사용 가능성을 먼저 검토한다.

==================================================
[Flutter 규칙]
==================================================
- flutter analyze를 반드시 통과해야 한다.
- deprecated API 사용 금지 (withOpacity 등).
- 다크모드가 기본이다. 색상 하드코딩 금지, 디자인 토큰 사용.
- 텍스트 스케일링 및 최소 터치 영역 48dp를 반드시 고려한다.
- build 메서드는 최대한 간결하게 유지하고 UI 렌더링만 담당한다.

==================================================
[문자열 / 다국어(i18n) 규칙]
==================================================
- UI 코드에 텍스트 하드코딩은 절대 금지한다.
  (한글/영문/숫자 포함 모든 사용자 노출 문자열)
- 모든 문자열은 반드시 다국어(i18n) 시스템을 통해서만 사용한다.
- AppStrings 또는 localization 파일을 통해 문자열을 참조한다.
- Text, Button, Dialog, Error Message 등 모든 UI 문자열에 적용한다.
- 디버그 로그를 제외한 사용자 노출 문자열 하드코딩 금지.
- 새로운 문자열 키를 추가할 경우 반드시 모든 지원 언어에 기본값을 함께 추가한다.

==================================================
[코드 중앙화 / 재사용 규칙]
==================================================
- 공통으로 뺄 수 있는 로직/위젯/상수는 반드시 중앙화한다.
  - lib/common/utils/
  - lib/common/widgets/
  - lib/common/constants/
- 같은 기능을 여러 파일로 분산시키지 않는다.
- 기존 공통 코드가 있다면 새 코드 작성보다 재사용을 우선한다.
- 불필요한 파일 분리로 구조를 복잡하게 만들지 않는다.

==================================================
[온보딩 규칙]
==================================================
온보딩은 총 5단계다:
1) 알림 권한 요청
2) 사진/갤러리 접근 권한 요청
3) 커뮤니티 가이드라인 동의
4) 콘텐츠 정책 동의
5) 신고/차단 안내 동의

- 3~5단계는 반드시 “OO에 동의합니다” 형태의 명시적 체크/액션이 필요하다.
- 체크박스는 컨트롤 영역을 눌렀을 때만 토글된다.
  (화면 빈 공간 터치로 토글되면 안 된다)
- 체크 상태 변경 시 전체 화면 리빌드 또는 애니메이션 재시작 금지.

==================================================
[다이얼로그 / 사용자 메시지 규칙]
==================================================
- 사용자에게 보여지는 에러/성공/안내 메시지는 반드시 CommonDialog를 사용한다.
- SnackBar 및 AlertDialog 직접 사용은 금지한다.
- 기술적인 에러 메시지(Exception, StackTrace 등)를 UI에 노출하지 않는다.

==================================================
[Riverpod 규칙]
==================================================
- provider 내부에서 BuildContext 사용 금지.
- 네비게이션, 다이얼로그 등 side-effect는 ref.listen에서만 처리한다.
- 상태는 immutable로 유지하고 copyWith로만 갱신한다.
- build 메서드에서 직접 side-effect 수행 금지.

==================================================
[Supabase 규칙]
==================================================
- RLS를 절대 약화시키지 않는다.
- SECURITY DEFINER로 RLS를 우회하는 것도 금지한다.
- 스키마 변경은 SQL 마이그레이션으로만 수행한다.
- 테이블/컬럼 네이밍은 snake_case를 유지한다.
- Supabase 호출은 data 레이어(DAO/Repository)에서만 수행한다.
- (RPC 사용 시) 직접 테이블 접근(from/select/insert/update/delete) 금지.
- 다른 테이블의 RLS로 인해 JOIN이 불가능한 경우:
  - 스냅샷 필드를 추가하여 JOIN 없이 조회 가능하게 한다.
  - 예: journey_recipients.sender_user_id, snapshot_content, snapshot_image_count
  - 스냅샷은 데이터 생성 시점(INSERT)에 함께 채운다.

==================================================
[로깅 규칙]
==================================================
- print()는 반드시 if (kDebugMode)로 감싼다.
- 모든 파일 상단에 static const String _logPrefix 선언 필수.
- 로깅은 AppStrings.emoji* + _logPrefix 포맷을 따른다.
- 하드코딩된 문자열이나 이모지로 로깅 금지.

==================================================
[검증 규칙]
==================================================
- 변경 후 flutter analyze 통과는 필수다.
- 가능하면 flutter test도 실행한다.
- // ignore: 주석으로 linter 경고를 숨기지 않는다.

==================================================
[출력 규칙]
==================================================
- 작업 시 먼저 간단한 작업 계획을 설명한다.
- 그 다음 변경된 파일 및 변경 내용을 요약한다.
- 파괴적 변경이 의심되면 작업 전에 반드시 질문한다.
